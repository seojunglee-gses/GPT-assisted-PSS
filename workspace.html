<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workspace | ChatGPT-assisted PPSS Platform</title>
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <nav class="sidebar">
    <div class="logo">PPSS</div>
    <ul>
      <li><a href="index.html"><span class="icon">üè†</span><span>Home</span></a></li>
      <li><a href="workspace.html" class="active"><span class="icon">üß†</span><span>Workspace</span></a></li>
      <li><a href="report.html"><span class="icon">üìä</span><span>Report</span></a></li>
      <li><a href="settings.html"><span class="icon">‚öôÔ∏è</span><span>Settings</span></a></li>
    </ul>
  </nav>
  <main class="content workspace-main">
    <header class="workspace-header">
      <h1>Collaborative Workspace</h1>
      <p>
        Your collaborative space for planning. Discuss, design, and decide with AI support ‚Äî all in one place.
      </p>
    </header>

    <section class="workflow">
      <div class="stage-navigation" role="tablist" aria-label="Workspace stages">
        <button type="button" class="stage-step active" data-stage="problem-definition" data-index="0" role="tab"
          aria-selected="true">
          <span class="step-icon">üß≠</span>
          <span class="step-label">Problem Definition</span>
        </button>
        <button type="button" class="stage-step" data-stage="data-analysis" data-index="1" role="tab"
          aria-selected="false">
          <span class="step-icon">üìä</span>
          <span class="step-label">Data Analysis</span>
        </button>
        <button type="button" class="stage-step" data-stage="design-alternatives" data-index="2" role="tab"
          aria-selected="false">
          <span class="step-icon">üõ†Ô∏è</span>
          <span class="step-label">Design/Plan Alternatives</span>
        </button>
        <button type="button" class="stage-step" data-stage="design-evaluation" data-index="3" role="tab"
          aria-selected="false">
          <span class="step-icon">üîç</span>
          <span class="step-label">Design/Plan Evaluation</span>
        </button>
        <button type="button" class="stage-step" data-stage="design-decision" data-index="4" role="tab"
          aria-selected="false">
          <span class="step-icon">üìë</span>
          <span class="step-label">Design/Plan Decision</span>
        </button>
      </div>

      <div class="stage-progress" aria-hidden="true">
        <div class="stage-progress__track">
          <div class="stage-progress__fill" style="width: 0%"></div>
        </div>
        <span class="stage-progress__label">Stage 1 of 5</span>
      </div>

      <div class="stage-container">
        <article id="problem-definition" class="stage-content active" role="tabpanel">
          <div class="stage-grid">
            <div class="stage-panel narrative-panel">
              <figure class="hero-figure">
                <img src="https://cdn.m-joongang.com/news/photo/201506/20150618_2_306921.jpg"
                  alt="Designers collaborating with post-it notes" />
                <figcaption>Picture of Seoul station overpass.</figcaption>
              </figure>
              <div class="panel-copy">
                <h2>Clarify the Strategic Challenge</h2>
                <p>
                  Before its transformation, the Seoul Station Overpass stood as a deteriorating yet symbolically 
                  important piece of infrastructure in the heart of the city. Built in 1970 to ease mounting traffic 
                  and support fast-paced urban growth, the elevated roadway once embodied Seoul‚Äôs modernization. Over time,
                  however, structural aging, safety concerns, and limited pedestrian accessibility made it increasingly incompatible 
                  with the evolving needs of the city. Still, as conversations around urban regeneration grew, the overpass began to be
                  seen not only as an obsolete structure but also as a potential anchor for revitalizing the fragmented districts surrounding Seoul Station.
                </p>
                <p>
                  Structurally, the overpass was narrow, elevated up to 17 meters, and originally designed for vehicle-heavy 
                  use‚Äîconditions that made it unsafe for public recreation and difficult for pedestrians to reach. Its height and 
                  position over major arterial roads and rail tracks also contributed to its isolation from the street-level environment. 
                  Although the view from the overpass mainly looked onto adjacent buildings rather than open landscapes, the area below and around
                  it was rich with cultural, historical, and industrial assets, creating opportunities for a more integrated urban strategy.
                </p>
                <p>
                  The districts west of Seoul Station‚Äîsuch as Jungnim-dong, Seogye-dong, and Malli-dong‚Äîhad long suffered from physical 
                  decline and social isolation due to the separation created by the railway. This isolation contributed to economic 
                  stagnation and political marginalization, even as these neighborhoods maintained unique cultural landscapes, 
                  including historic sites, traditional hillsides, and a concentrated sewing and garment industry. These characteristics 
                  positioned the western neighborhoods as strong candidates for community-based urban regeneration.
                </p>
                <p>
                  On the eastern side, Namdaemun Market and Hoehyeon-dong faced different challenges. Namdaemun Market, one of Korea‚Äôs 
                  largest and most historic commercial zones, struggled with aging facilities, competing stakeholder interests, 
                  declined tourism, and complex governance issues. Hoehyeon-dong, caught between Namsan and the commercial core, 
                  had long been constrained by height limits and fragmented development patterns. Despite these challenges, both areas 
                  retained symbolic significance and benefited from their strategic location at Seoul‚Äôs urban gateway.
                </p>
                <p>
                  Across all neighborhoods, local groups expressed shared concerns as the city considered closing the overpass. 
                  Many demanded alternative traffic routes, plans to alleviate anticipated congestion, and renewed attention to 
                  long-stalled development around the northern station area. Others emphasized the need to address local social issues‚Äîparticularly 
                  homelessness, vulnerable housing, and support for the declining sewing industry. Specific districts also raised their own priorities,
                  from calls to modernize Namdaemun Market to community-led planning efforts in Seogye-dong that sought a balanced approach to redevelopment.
                </p>
                <p>
                  Overall, before its conversion into a public park, the Seoul Station Overpass existed at the intersection of aging infrastructure,
                  fragmented urban fabric, and a dense concentration of cultural and economic activities. Although its original transportation role had diminished, 
                  the surrounding neighborhoods‚Äô conditions suggested that reimagining the overpass could play a central role in stitching together divided districts 
                  and offering a new direction for urban regeneration in central Seoul.
                </p>
              </div>
            </div>
            <div class="stage-panel chat-panel">
              <header>
                <h2>Agent</h2>
                <p class="chat-description">Live conversation through the ChatGPT API to expand the shared understanding of the
                  PPSS challenge.</p>
              </header>
              <div class="chat-log" aria-live="polite" data-stage="problem-definition">
                <div class="message user">
                  <span class="role">Resident</span>
                  <p>My neighborhood is cut off from the railroad and suffers from poor infrastructure. How can urban regeneration project mitigate this?</p>
                </div>
                <div class="message assistant">
                  <span class="role">Assistant</span>
                  <p> <b>1. Understanding the Project and Context:</b> <br>
                    The project involves regenerating a section of an elevated road west of Seoul
                    Station, which was opened in 1970. The area has suffered from
                    underdevelopment compared to the eastern side of the station, partly due to the
                    physical barrier created by the railway. Residents are particularly concerned about
                    infrastructure improvements, including the relocation of the garbage truck
                    garage. This elevated road is now in need of regeneration due to its deteriorated
                    condition, and there are challenges related to safety and connectivity with the
                    surrounding areas.
                  </p>
                  <p>  
                    <b>2. Integrating Local Knowledge:</b> <br>
                    The local area's historical and cultural significance is central to the regeneration
                    project. This part of Seoul is characterized by old alleyways, hilly terrain, and
                    various historical and industrial heritage sites. The presence of social issues, such
                    as homelessness, in proximity to the station adds complexity to the regeneration
                    efforts. <br>
                    Given the focus on maintaining historical character while improving infrastructure,
                    local residents' knowledge will be key in addressing issues such as alleyway
                    preservation, garbage truck garage relocation, and improving accessibility to
                    heritage sites.
                  </p>
                  <p>
                    <b>3. Applying Planning Knowledge:</b> <br>
                    From the "Planning Knowledge" document, urban regeneration in Seoul aims to
                    address multiple layers of urban decay while balancing cultural preservation and
                    modern development needs. Seoul's planning philosophy has emphasized green
                    spaces, pedestrian-friendly areas, and improving the social fabric in marginalized
                    areas, such as the west of Seoul Station. <br>
                    Potential Solutions from Planning Knowledge:
                    Utilizing the concept of "urban acupuncture," small but impactful
                    interventions in key areas can bring broader regeneration to the community.
                    For example, relocating the garbage truck garage and converting it into a
                    community space or green area would both address local concerns and align
                    with Seoul's green space planning . <br>
                    Improving pedestrian infrastructure around historical sites and integrating
                    them with modern transportation hubs (like Seoul Station) will help bridge
                    the east-west divide and enhance connectivity.
                  </p>
                  <p>
                    <b>4. Addressing Project Knowledge and Resident Concerns: </b> <br>
                    Relocation of the Garbage Truck Garage: This has been a long-standing
                    issue in the area. The regeneration project must focus on finding a suitable
                    location for the garage while using the vacated space for more beneficial
                    community purposes, such as parks or cultural hubs.<br>
                    Improved Accessibility: Due to the height and structural complexity of the
                    elevated road, ensuring safety and accessibility will be vital. Addressing the
                    physical barriers and connectivity challenges caused by the railway will
                    enhance the social and cultural integration of the area.<br>
                    Resident Involvement: Encouraging strong local participation in each phase of
                    the project is key to success. You can use your "local knowledge" to advocate for
                    the preservation of historical alleyways and integration of heritage sites into the
                    regeneration plan.
                  </p>
                  <p>
                    <b>5. Planning for the Future:</b> <br>
                    The regeneration plan needs to integrate sustainable development strategies
                    to address both environmental and social issues. Incorporating pedestrian
                    zones, green spaces, and mixed-use development can help revitalize the area
                    while preserving its historical and cultural assets. <br>
                    Enhancing public participation, especially in decision-making stages, will
                    ensure that the project aligns with both resident needs and broader city
                    goals of equitable development. <br>
                    In summary, this project can leverage the cultural and historical assets of the
                    west side of Seoul Station to create a vibrant, well-connected area. It will be
                    crucial to ensure that infrastructure improvements, including relocating the
                    garage, are done in a way that reflects the needs of the residents and the city's
                    broader regeneration goals
                  </p>
                </div>
              </div>
              <form class="chat-form" aria-label="Send a message to ChatGPT" data-stage="problem-definition">
                <label class="visually-hidden" for="message-stage-1">Message</label>
                <div class="chat-composer">
                  <input id="message-stage-1" class="chat-input" type="text" name="message"
                    placeholder="Compose your prompt..." required />
                  <button type="submit" class="chat-send" aria-label="Send message">Send</button>
                </div>
              </form>
              <div class="stage-actions">
                <button type="button" class="complete-stage" data-stage="problem-definition">Complete Stage</button>
                <p class="stage-status" aria-live="polite"></p>
              </div>
            </div>
          </div>
        </article>

        <article id="data-analysis" class="stage-content" role="tabpanel" hidden>
          <div class="stage-grid">
            <div class="stage-panel analysis-panel">
              <h2>Case Studies</h2>
              <p>Select a tab to review the projects for the data analysis stage.</p>
              <div class="data-tabs" role="tablist" aria-label="Data analysis evidence tabs">
                <button type="button" class="data-tab active" data-tab="patterns" role="tab" aria-selected="true">789 Art Zone</button>
                <button type="button" class="data-tab" data-tab="painpoints" role="tab" aria-selected="false">Gyeungui Line Forest Park</button>
                <button type="button" class="data-tab" data-tab="opportunities" role="tab" aria-selected="false">Highline Park</button>
              </div>
              <div class="data-tab-content active" id="patterns" role="tabpanel">
                <img src="https://museumofwander.com/wp-content/uploads/2023/03/DSC00795.jpg"
                  alt="789 Art Zone in Beijing, China" />
                <p>
                  The 798 Art Zone (also known as Dashanzi Art District) in Beijing is a globally recognized urban regeneration project 
                  that transformed a 1950s military electronics factory complex into China‚Äôs leading contemporary art hub. Originally 
                  part of the 718 Joint Project, the Bauhaus-style industrial complex was built in collaboration with East Germany and served 
                  as a model socialist factory‚Äîa self-contained community providing housing, schools, and healthcare for its workers.
                 </p>
                 <p>
                  Following China‚Äôs economic reforms in the 1980s, production declined, and the complex was abandoned. 
                  In the mid-1990s, artists such as Sui Jianguo, Huang Rui, and Liu Suola began occupying the vacant spaces, 
                  attracted by low rent and spacious, light-filled interiors. This spontaneous occupation marked the first phase 
                  (‚Äúincubation period‚Äù) of the district‚Äôs rebirth as a creative enclave.
                 </p>
                 <p>
                  In the early 2000s, the ‚ÄúSeven Star Group‚Äù, a state enterprise owning the site, sought to demolish the buildings 
                  for redevelopment. In response, artists organized exhibitions such as Reconstruction 798 and the Dashanzi International 
                  Art Festival (2004‚Äì2006), drawing international attention and civic support. The city government ultimately protected 798
                  as a cultural heritage site, designating it a ‚ÄúCreative Cultural Industries Cluster‚Äù in 2008.
                 </p>
                 <p>
                  Today, 798 Art Zone covers 138 hectares in Beijing‚Äôs Chaoyang District, featuring art galleries, design studios, 
                  caf√©s, and creative companies. It attracts both domestic and international visitors and plays a key role in Beijing‚Äôs
                  city branding. However, rapid commercialization and rising rents have pushed many pioneering artists to relocate to
                  cheaper districts like Caochangdi and Songzhuang, raising concerns about gentrification and the loss of 798‚Äôs avant-garde spirit.
                 </p>
                 <p>
                  Despite this, the zone remains a symbol of China‚Äôs cultural transformation, representing the intersection of industrial 
                  heritage reuse, creative economy, and state-led urban marketing. It embodies the paradox of contemporary Chinese 
                  urbanism‚Äîbalancing artistic freedom, economic pragmatism, and government control.
                 </p>
                 <p>
                  Key themes:
                  ‚ñ∑ Adaptive reuse of socialist industrial heritage (Bauhaus architecture)
                  ‚ñ∑ Emergence from grassroots artist occupation to state-recognized cultural hub
                  ‚ñ∑ Integration into Beijing‚Äôs global city marketing strategy
                  ‚ñ∑ Tensions between artistic authenticity and commercialization
                  ‚ñ∑ Influence on similar creative clusters across China (e.g., Shanghai‚Äôs M50, Chengdu, Kunming)
                </p>
              </div>
              <div class="data-tab-content" id="painpoints" role="tabpanel" hidden>
                <img src="https://parks.seoul.go.kr/images/egovframework/com/template/gus3.jpg"
                  alt="Gyeungui Line Forest Park in Seoul, Korea" />
                <p>
                  The Gyeongui Line Forest Park in Seoul is a major urban regeneration project that transformed an abandoned 
                  railway corridor into a linear green space stretching approximately 6.3 km from Gajwa Station to Yongsan
                  Community Center. Initiated in 2009 as part of the city‚Äôs regeneration plan, it reconnects neighborhoods 
                  once divided by the railway and enhances the quality of urban life by returning disused land to the public.
                </p>
                <p>
                  The project originated from a 2004 Seoul Institute study on reusing idle rail land and was implemented in 
                  stages‚Äîbeginning with the Daeheung section (760 m) in 2012 and expanding through Yeonnam-dong and Yeomni-dong. 
                  The park‚Äôs design integrates green space with pedestrian accessibility, linking surrounding neighborhoods and 
                  commercial areas while absorbing local pedestrian traffic into its flow.
                </p>
                 <p>
                  A key characteristic of the Gyeongui Line Forest Park is its strong emphasis on citizen participation. In 2014, 
                  the city and Mapo District established ‚ÄúGyeongui Line Forest Keepers‚Äù (Gyeongui-seon Supgil-jigi)‚Äîa nonprofit 
                  organization modeled after New York‚Äôs Friends of the High Line. This group includes residents, designers, students,
                  and local officials who collaborate to manage and activate the park through community-based programs such as cultural 
                  events, gardening, environmental cleanups, and public art projects (White Butterfly Project).
                </p>
                <p>
                  The park has become a vibrant urban space where citizens and visitors gather for leisure and cultural activities, 
                  especially in the Yeonnam-dong area near Hongdae. However, it also faces challenges like gentrification, waste management,
                  and pedestrian‚Äìcyclist safety conflicts. Local forums and initiatives have been organized to mitigate these issues and ensure
                  sustainable coexistence between long-term residents and newcomers.
                </p>
                <p>
                  The Gyeongui Line Forest Park exemplifies adaptive reuse of post-industrial infrastructure through participatory governance, 
                  aligning with global trends such as New York‚Äôs High Line and Paris‚Äôs Promenade Plant√©e. It symbolizes Seoul‚Äôs shift from 
                  government-driven redevelopment toward citizen-led urban regeneration, where community stewardship shapes the identity and sustainability of public spaces.
                </p>
                <p>
                  Key themes:
                  ‚ñ∑ Transformation of an abandoned railway into a linear urban park
                  ‚ñ∑ Citizen-led management through Gyeongui Line Forest Keepers
                  ‚ñ∑ Cultural and ecological revitalization of neighborhoods
                  ‚ñ∑ Challenges of gentrification and inclusive urban regeneration
                </p>
              </div>
              <div class="data-tab-content" id="opportunities" role="tabpanel" hidden>
                <img src="https://cdn.vox-cdn.com/thumbor/vfP32EdfHssHtEknAq-I1Tyv0Zw=/0x0:2000x1333/2070x828/filters:focal(840x507:1160x827):format(webp)/cdn.vox-cdn.com/uploads/chorus_image/image/63748975/Highline_Guide_Max_Touhey_20190416_0082.0.jpg"
                  alt="Highline Park in New York, USA" />
                <p>
                  The High Line Park is an elevated linear park in Manhattan, New York City, created from an abandoned freight rail 
                  line that once ran through the Chelsea district. Originally built in the 1930s to prevent frequent traffic accidents 
                  between trains and vehicles on 10th Avenue‚Äîonce known as ‚ÄúDeath Avenue‚Äù‚Äîthe railway operated until 1980 before being 
                  closed and neglected for decades.
                </p>
                <p>       
                  In the 1990s, the structure faced demolition, but local residents organized a civic movement called Friends of 
                  the High Line (FHL) to preserve and repurpose it as a public park. Founded by Joshua David and Robert Hammond in 1999,
                  the group succeeded in convincing the city and property owners to support redevelopment instead of removal.
                </p>
                <p>
                  A public‚Äìprivate partnership between the City of New York and FHL led to the park‚Äôs creation. The city allowed developers 
                  to transfer development rights from nearby lots, while FHL raised $3.5 million and the city invested $15.75 million, later 
                  increased by Mayor Michael Bloomberg to a total of $43.25 million. In 2003, an international design competition attracted 
                  720 teams from 36 countries. The winning proposal came from Field Operations (landscape architecture) and Diller Scofidio 
                  + Renfro (architecture), whose design integrated nature and urban infrastructure through the concept of ‚ÄúAgri-tecture‚Äù
                  ‚Äîa hybrid of agriculture and architecture.
                </p>
                <p>
                  Opened in stages from 2009, the High Line preserves the industrial character of the area while introducing sustainable 
                  greenery, wooden decks, and pedestrian paths that blend with the city‚Äôs skyline. The park provides a serene walking
                  experience above the bustling streets, offering views of the Hudson River and Manhattan‚Äôs buildings.
                </p>
                <p>
                  Today, the High Line stands as a symbol of urban regeneration, transforming a decaying industrial relic into a vibrant 
                  public space that promotes ecological design, cultural vitality, and social inclusivity. It also reinforced New York‚Äôs
                  identity as a city capable of turning ‚Äúurban scars‚Äù into celebrated landmarks.
                </p>
                <p>
                  Key themes:
                  ‚ñ∑ Adaptive reuse of obsolete infrastructure
                  ‚ñ∑ Citizen-led activism and public‚Äìprivate collaboration
                  ‚ñ∑ Integration of nature and urban life (Agri-tecture)
                  ‚ñ∑ Model for sustainable urban regeneration and placemaking
                </p>
              </div>
            </div>
            <div class="stage-panel chat-panel">
              <header>
                <h2> Agent</h2>
                <p class="chat-description">Explore relevant data and case studies.
                AI agents summarize reports, analyze patterns, and help users interpret findings for informed planning.</p>
              </header>
              <div class="chat-log" aria-live="polite" data-stage="data-analysis">
                <div class="message user">
                  <span class="role">Resident</span>
                  <p>How did the cases solve the problem of regeneration projects causing residents to move or housing prices to rise?</p>
                </div>
                <div class="message assistant">
                  <span class="role">Assistant</span>
                       The issue of resident displacement and rising housing prices, often referred to
                      as gentrification, is a common challenge in urban regeneration projects. The
                      three cases of urban regeneration‚ÄîNew York‚Äôs High Line Park, Seoul‚Äôs
                      Gyeongui Line Forest Park, and Beijing‚Äôs 798 Art Zone‚Äîeach tackled these
                      issues with varying degrees of success and different approaches. Here's how
                      these projects managed or mitigated the risks of displacement and rising
                      housing prices:
                <p>
                      <b>1. High Line Park, New York:</b>
                <br>  
                  Gentrification Impact:
                  The development of the High Line Park led to a significant rise in property
                   values in the surrounding areas. While the project revitalized the
                  neighborhood and attracted many visitors, it also caused rents and real
                  estate prices to surge, which led to the displacement of some long-term residents.
                <br>
                  Mitigation Strategies:
                  Affordable Housing Policies: New York City attempted to mitigate the
                  gentrification effects by implementing affordable housing policies in the
                  surrounding areas. These policies were aimed at preserving a mix of income
                  levels by setting aside a certain percentage of new housing developments
                  for affordable units.
                <br>
                  Community Engagement: The Friends of the High Line, a communitybased
                  organization, played a crucial role in ensuring that the park's
                  development addressed local concerns. Their involvement helped to slow
                  down rapid gentrification by advocating for policies that protected longterm
                  residents.
                <br>
                  <b>Lessons for Your Project:</b>
                  Affordable Housing: Incorporating policies to ensure affordable housing in
                  your area could help prevent displacement. The local government and
                  developers can set aside a portion of new housing developments for
                  affordable units to maintain diversity.
                <br>
                  Strong Community Advocacy: Establishing resident-led organizations, like
                  "Friends of the High Line," could provide a platform for residents to voice
                  concerns about rising housing prices and advocate for solutions to prevent
                  displacement.
                </p>
                <p>
<b>2. Gyeongui Line Forest Park, Seoul:</b>
                <br>
                  Gentrification Impact:
                  The transformation of the Gyeongui Line into a forest park also led to
                  increased property values in nearby areas, particularly in the
                  popular Yeonnam-dong neighborhood. This increase in property values
                  brought in more cafes, businesses, and wealthier residents, leading to the
                  displacement of some original inhabitants.
                <br>
                  Mitigation Strategies:
                  Resident Participation in Design and Planning: One key strategy to
                  counteract gentrification in the Gyeongui Line project was
                  extensive resident participation in the planning and design of the park.
                  Local residents were actively involved in decisions about how the park
                  would be developed, ensuring that the project aligned with their needs and
                  reduced the pace of external commercialization.
                <br>
                  Non-Profit Management and Oversight: The project created an
                  organization, Gyeongui Line Forest Park Stewards, that continues to
                  involve local residents in managing and preserving the park. This has
                  helped slow the process of gentrification by ensuring that the park remains
                  a space for the community and preventing excessive commercialization.
                <br>
                  <b>Lessons for Your Project:</b>
                <br>
                  Community Participation: Ensuring that local residents are actively
                  involved in the design and development phases of your urban regeneration
                  project could help reduce displacement risks. Including residents in
                  decision-making empowers them and helps preserve the community
                  character.
                <br>
                  Non-Profit Oversight: A community-led organization or non-profit could
                  oversee aspects of the project, helping manage potential gentrification
                  pressures by keeping the focus on local needs rather than
                  commercialization.
                </p>
                <p>
                  <b>3. 798 Art Zone, Beijing: </b>
                <br>
                  Gentrification Impact:
                  The transformation of Beijing's 798 Art Zone into a cultural and
                  commercial hub also resulted in rising property prices, which led to the
                  displacement of some original artists and residents who could no longer
                  afford to live or work in the area.
                <br>
                  Mitigation Strategies:
                  Government Regulation: The Chinese government took measures to
                  regulate property development in the area by placing restrictions on largescale
                  commercial projects. This helped to control rent prices to some
                  extent, although some displacement still occurred due to the popularity of
                  the area as a tourist destination.
                <br>
                  Creating Cultural Spaces for Locals: Despite commercialization, the 798
                  Art Zone maintained a focus on providing affordable studio spaces and
                  public cultural venues, which kept the area attractive to both artists and
                  tourists, reducing the exclusive commercialization of the space.
                <br>
                  <b>Lessons for Your Project: </b>
                <br>
                  Regulate Commercial Development: Implementing regulations to control
                  large-scale commercial developments around the regeneration site could
                  help maintain affordability for local residents.
                <br>
                  Cultural and Public Spaces: Like the 798 Art Zone, prioritizing public
                  cultural venues and community spaces in your project could help balance
                  commercial interests with local needs, ensuring the neighborhood remains
                  accessible to current residents.
                </p>
                <p>                  
                  <b>Summary of Strategies to Mitigate Gentrification Across the
                  Cases: </b> 
                  <br>
                  Affordable Housing Policies: Ensure that a portion of new developments
                  are designated as affordable housing, as seen in the High Line Park case.<br>
                  Community Participation: Involve local residents in the planning and
                  design process to ensure the project reflects their needs, a key strategy in
                  both the Gyeongui Line and High Line Park cases. <br>
                  Non-Profit or Community-Led Oversight: Set up community-led
                  organizations or non-profits to manage and protect the public spaces, as
                  shown in the Gyeongui Line project. <br>
                  Government Regulation: Implement zoning laws or regulations that
                  prevent large-scale commercial developments from taking over the area,
                  helping to maintain affordability.<br>
                  By learning from these cases, your urban regeneration project can incorporate
                  strategies to mitigate rising housing prices and prevent the displacement of
                  local residents while fostering a well-balanced and thriving community
                </p>
                </div>
              </div>
              <form class="chat-form" aria-label="Send a message to ChatGPT" data-stage="data-analysis">
                <label class="visually-hidden" for="message-stage-2">Message</label>
                <div class="chat-composer">
                  <input id="message-stage-2" class="chat-input" type="text" name="message"
                    placeholder="Ask about anomalies, clusters, or correlations..." required />
                  <button type="submit" class="chat-send" aria-label="Send message">Send</button>
                </div>
              </form>
              <div class="stage-actions">
                <button type="button" class="complete-stage" data-stage="data-analysis">Complete Stage</button>
                <p class="stage-status" aria-live="polite"></p>
              </div>
            </div>
          </div>
        </article>

        <article id="design-alternatives" class="stage-content" role="tabpanel" hidden>
          <div class="stage-grid">
            <div class="stage-panel gallery-panel">
              <h2>Concept Visualizations</h2>
              <p>
                Images generated through the ChatGPT image pipeline.
              </p>
              <div class="image-strip">
                <figure>
                  <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/resident.png?raw=true"
                    alt="green linear park and pedestrian friendly walkway design" />
                  <figcaption>Green linear park and pedestrian friendly walkway design.</figcaption>
                </figure>
                <figure>
                  <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/resident2.png?raw=true"
                    alt="Improvement in Industrial Heritage Preservation, Cultural and Public Spaces, Historical Storytelling, Artistic Elements" />
                  <figcaption>Improvement in Industrial Heritage Preservation, Cultural and Public Spaces, Historical Storytelling, Artistic Elements.</figcaption>
                </figure>
          
              </div>
            </div>
            <div class="stage-panel chat-panel">
              <header>
                <h2>Agent</h2>
                <p class="chat-description">Create and visualize your own design ideas.
                Using generative AI tools, users can produce 2D or 3D visual concepts that express their vision for the site.</p>
              </header>
              <div class="chat-log" aria-live="polite" data-stage="design-alternatives">
                <div class="message assistant">
                  <span class="role">Assistant</span>
                  <p>What aspects of the design do you think need improvement?</p>
                </div>
                <div class="message user">
                  <span class="role">Resident</span>
                  <p>The overpass is well-integrated into the urban landscape
                    with lush greenery, open walkways, and connections to the surrounding
                    cityscape. However, I need a improvement.<br>
                    The image lacks visible elements reflecting the neighborhood‚Äôs industrial past. Features like exposed steel
                    beams, remnants of old factory buildings, or industrial motifs are missing. While the walkways are well-defined, there
                    seems to be a lack of public spaces for cultural activities, art installations,
                    or small performance areas. These elements are crucial to maintaining the
                    neighborhood‚Äôs cultural identity, as emphasized in the prompt.
                    There are no visible historical plaques or
                    interpretive signage that tell the story of the neighborhood‚Äôs industrial
                    history. These could be integrated into seating areas or along railings.
                    Public art installations, murals, or sculptures celebrating
                    the neighborhood‚Äôs history are missing from the design. These could add a
                    sense of place and make the project more unique.
                  </p>
                </div>
                <div class="message assistant">
                  <span class="role">Assistant</span>
                  <p>The new image is displayed on the left panel.</p>
                </div>
              </div>
              <form class="chat-form" aria-label="Send a message to ChatGPT" data-stage="design-alternatives">
                <label class="visually-hidden" for="message-stage-3">Message</label>
                <div class="chat-composer">
                  <input id="message-stage-3" class="chat-input" type="text" name="message"
                    placeholder="Describe a new alternative..." required />
                  <button type="submit" class="chat-send" aria-label="Send message">Send</button>
                </div>
              </form>
              <div class="stage-actions">
                <button type="button" class="complete-stage" data-stage="design-alternatives">Complete Stage</button>
                <p class="stage-status" aria-live="polite"></p>
              </div>
            </div>
          </div>
        </article>

        <article id="design-evaluation" class="stage-content" role="tabpanel" hidden>
          <div class="stage-grid">
            <div class="stage-panel evaluation-panel">
              <h2>Design Candidates</h2>
              <p>Review and comment on designs proposed by others. Description shows key elements for the design.</p>
              <div class="photo-grid">
                <figure class="evaluation-photo" data-image-id="company">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/company2.png?raw=true"
                      alt="company" />
                    <button type="button" class="photo-zoom" aria-label="Multimodal transportation solutions, Pop-up stores and experiential marketing spaces, Interactive displays or public installations,
                                                                        Green spaces with commercial integration, Public plazas for events, Street-level marketing spaces, Lighting and safety">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>public transportation, commercial vitality, green spaces, and cultural engagement</figcaption>
                  <label class="ranking-control" for="rank-company">
                    <span>Assign a rank</span>
                    <select id="rank-company" class="ranking-select" data-image-id="company">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="government">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/Government2.png?raw=true"
                      alt="government" />
                    <button type="button" class="photo-zoom" aria-label="eco-friendly elements, abundant greenery, sustainable elements, social integration, neighborhood connectivity pedestrian-friendly zones, diverse use spaces">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>blend of history, culture, and modernity</figcaption>
                  <label class="ranking-control" for="rank-govenrment">
                    <span>Assign a rank</span>
                    <select id="rank-government" class="ranking-select" data-image-id="government">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="resident">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/resident2.png?raw=true"
                      alt="Green spaces, pedestrian pathways, cultural, industrial, and historical elements" />
                    <button type="button" class="photo-zoom" aria-label="Green Linear Park, Preserved Industrial Heritage, Cultural and Public Spaces, Pedestrian Connectivity and Accessibility,
                                                                          Historical Storytelling, Architectural Blend of Old and New, Community-Centric Design:">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>Green spaces, pedestrian pathways, cultural, industrial, and historical elements</figcaption>
                  <label class="ranking-control" for="rank-resident">
                    <span>Assign a rank</span>
                    <select id="rank-resident" class="ranking-select" data-image-id="resident">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="sewing">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/sewing2.png?raw=true"
                      alt="logistics, industrial aspects, preserving the public interaction and community-centered features." />
                    <button type="button" class="photo-zoom" aria-label="Centralized Hub, Pedestrian Engagement, Incorporation of Green Spaces, Fashion Display Areas, 
                      Logistics and Delivery Routes, Public Interaction with Sewing, Fashion Runway or Performance Space, Industrial Elements">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>logistics, industrial aspects, preserving the public interaction and community-centered features.</figcaption>
                  <label class="ranking-control" for="rank-sewing">
                    <span>Assign a rank</span>
                    <select id="rank-sewing" class="ranking-select" data-image-id="sewing">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="planner">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/Urban Planner2.png?raw=true"
                      alt="historical preservation, cultural integration, and modern sustainable technologies" />
                    <button type="button" class="photo-zoom" aria-label="Green Spaces, Pedestrian Accessibility, Historical Elements, Cultural Installations, Modern Amenities, Community Spaces">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>historical preservation, cultural integration, and modern sustainable technologies</figcaption>
                  <label class="ranking-control" for="rank-planner">
                    <span>Assign a rank</span>
                    <select id="rank-planner" class="ranking-select" data-image-id="planner">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="vendor">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/vendor2.png?raw=true"
                      alt="commerce through pop-up stores, cultural and interactive elements" />
                    <button type="button" class="photo-zoom" aria-label="Green Spaces and Pedestrian Areas, Pop-Up Stores and Caf√©s, Connectivity and Flow, Natural Aesthetic
                                                                          Cultural Integration, Public Art and Performances, Signage and Wayfinding, Interactive Spaces">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>commerce through pop-up stores, cultural and interactive elements</figcaption>
                  <label class="ranking-control" for="rank-vendor">
                    <span>Assign a rank</span>
                    <select id="rank-vendor" class="ranking-select" data-image-id="vendor">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
                <figure class="evaluation-photo" data-image-id="visitor">
                  <div class="photo-wrapper">
                    <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/visitor2.png?raw=true"
                      alt="commercial and artistic elements, visibility of accessibility features and enhancing nighttime appeal" />
                    <button type="button" class="photo-zoom" aria-label="Green Spaces, Accessibility and Wide Walkways, Commercial and Cultural Elements, Dynamic Lighting, Public Art and Sculptures">
                      <span aria-hidden="true">üîç</span>
                    </button>
                    <span class="ranking-badge" hidden></span>
                  </div>
                  <figcaption>ommercial and artistic elements, visibility of accessibility features and enhancing nighttime appea</figcaption>
                  <label class="ranking-control" for="rank-visitor">
                    <span>Assign a rank</span>
                    <select id="rank-visitor" class="ranking-select" data-image-id="visitor">
                      <option value="">Unranked</option>
                      <option value="1">Rank 1 </option>
                      <option value="2">Rank 2 </option>
                      <option value="3">Rank 3 </option>
                      <option value="4">Rank 4 </option>
                      <option value="5">Rank 5 </option>
                      <option value="6">Rank 6 </option>
                      <option value="7">Rank 7 </option>
                    </select>
                  </label>
                </figure>
              </div>
            </div>
            <div class="stage-panel chat-panel">
              <header>
                <h2>Agent</h2>
                <p class="chat-description">Review and comment on designs proposed by others. Users evaluate alternatives, exchange opinions, and collectively reflect on what works best.</p>
              </header>
              <div class="chat-log" aria-live="polite" data-stage="design-evaluation">
                <div class="message assistant">
                  <span class="role">Assistant</span>
                  <p>Which design do you like the best, and why?</p>
                </div>
              </div>
              <form class="chat-form" aria-label="Send a message to ChatGPT" data-stage="design-evaluation">
                <label class="visually-hidden" for="message-stage-4">Message</label>
                <div class="chat-composer">
                  <input id="message-stage-4" class="chat-input" type="text" name="message"
                    placeholder="Request comparative evaluations or metrics..." required />
                  <button type="submit" class="chat-send" aria-label="Send message">Send</button>
                </div>
              </form>
              <div class="stage-actions">
                <button type="button" class="complete-stage" data-stage="design-evaluation">Complete Stage</button>
                <p class="stage-status" aria-live="polite"></p>
              </div>
            </div>
          </div>
        </article>

        <article id="design-decision" class="stage-content" role="tabpanel" hidden>
          <div class="stage-grid">
            <div class="stage-panel report-panel">
              <h2>Executive Summary</h2>
              <p>
                Consolidate insight streams into a transparent recommendation for the proactive product-service system strategy.
              </p>
              <div class="report-body">
                <h3>Stage summary</h3>
                <p>
                  The integrated mobility service reduces per-passenger emissions by 28% compared to the baseline. Customer
                  satisfaction improves through predictive scheduling and inclusive design touchpoints.
                </p>
                <h3>Decision Criteria</h3>
                <ul>
                  <li>Adaptive routing lowers congestion events by 18% during peak windows.</li>
                  <li>Energy-efficient materials extend vehicle lifecycles by 22%.</li>
                  <li>Service partnerships unlock three new regenerative revenue streams.</li>
                </ul>
                <h3>Next Steps</h3>
                <p>
                  Scale the telemetry stack across partner fleets, finalize stakeholder governance, and prepare a policy briefing
                  aligned with the article's recommendations.
                </p>
              </div>
            </div>
            <div class="stage-panel decision-panel">
              <h2>Decision panel</h2>
              <p> Make a final decision based on collective feedback. 
              </p>
              <div class="decision-insights">
                <section class="leader-section">
                  <h3>Top Concept Spotlight</h3>
                  <div class="leader-image">
                      <img src="https://github.com/seojunglee-gses/GPT-assisted-PSS/blob/main/vendor2.png?raw=true">
                    </div>
                  <p class="leader-placeholder">Vendor design.</p>
                  <figure class="leader-card" hidden>
                    <figcaption>
                      <p class="leader-rank"></p>
                      <h4 class="leader-title"></h4>
                      <p class="leader-contributor" hidden></p>
                      <p class="leader-affinity"></p>
                      <p class="leader-caption"></p>
                    </figcaption>
                  </figure>
                </section>
              </div>
              <div class="decision-table-wrapper">
                <table class="decision-table">
                  <thead>
                    <tr>
                      <th scope="col">Concept</th>
                      <th scope="col">Contributor</th>
                      <th scope="col">Assigned Rank</th>
                      <th scope="col">Preference Index</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr data-image-id="prototype-shuttle">
                      <th scope="row">Adaptive Shuttle Entry</th>
                      <td>Team Aurora</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="telemetry-dashboard">
                      <th scope="row">Telemetry Intelligence Wall</th>
                      <td>Data Studio Kilo</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="accessibility-trials">
                      <th scope="row">Inclusive Boarding Trials</th>
                      <td>Accessibility Guild</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="mobility-hub-render">
                      <th scope="row">Regenerative Mobility Hub</th>
                      <td>Studio Meridian</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="service-app-ui">
                      <th scope="row">Service Orchestration App</th>
                      <td>Digital Team Nova</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="energy-dashboard">
                      <th scope="row">Energy Dispatch Dashboard</th>
                      <td>Telemetry Collective</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                    <tr data-image-id="community-lab">
                      <th scope="row">Community Co-design Lab</th>
                      <td>Engagement Network</td>
                      <td class="decision-rank">Unranked</td>
                      <td class="decision-preference">
                        <div class="preference-meter" aria-hidden="true"><span style="width: 0%"></span></div>
                        <span class="preference-label">Awaiting evaluation</span>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <div class="evaluation-lightbox" role="dialog" aria-modal="true" aria-hidden="true" hidden>
    <div class="lightbox-backdrop" data-close="true"></div>
    <div class="lightbox-content">
      <button type="button" class="lightbox-close" aria-label="Close expanded prototype image" data-close="true">‚úï</button>
      <img class="lightbox-image" src="" alt="" />
      <p class="lightbox-caption"></p>
    </div>
  </div>

  <script>
    (function () {
      const stageButtons = Array.from(document.querySelectorAll('.stage-step'));
      const stageContents = Array.from(document.querySelectorAll('.stage-content'));
      const tabButtons = Array.from(document.querySelectorAll('.data-tab'));
      const tabPanels = Array.from(document.querySelectorAll('.data-tab-content'));
      const completeButtons = Array.from(document.querySelectorAll('.complete-stage'));
      const progressFill = document.querySelector('.stage-progress__fill');
      const progressLabel = document.querySelector('.stage-progress__label');
      const stageCount = stageButtons.length || 1;
      const STORAGE_PREFIX = 'ppss';
      const CONVERSATION_KEY = (stage) => `${STORAGE_PREFIX}-conversation-${stage}`;
      const SUMMARY_KEY = (stage) => `${STORAGE_PREFIX}-summary-${stage}`;
      const STATUS_KEY = `${STORAGE_PREFIX}-stage-status`;
      const API_KEY_STORAGE = `${STORAGE_PREFIX}-openai-key`;
      const RANKING_KEY = `${STORAGE_PREFIX}-evaluation-rankings`;

      const stageConfig = {
        'problem-definition': {
          title: 'Problem Definition',
          systemPrompt:
            'You are a proactive product-service system strategist who helps teams clarify PPSS problem statements, stakeholder drivers, and sustainability intentions.',
          summaryPrompt:
            'Summarize the PPSS problem-definition dialogue into a short paragraph highlighting the core challenge, stakeholder commitments, and sustainability intentions.'
        },
        'data-analysis': {
          title: 'Data Analysis',
          systemPrompt:
            'You are a PPSS data analyst who explains trends, anomalies, and correlations for mobility service transformation.',
          summaryPrompt:
            'Summarize the evidence interrogation by listing the most critical demand, pain point, and opportunity signals uncovered for the PPSS initiative.'
        },
        'design-alternatives': {
          title: 'Design/Plan Alternatives',
          systemPrompt:
            'You are a PPSS co-creation assistant who compares and refines alternative service concepts with lifecycle awareness.',
          summaryPrompt:
            'Summarize the alternative generation dialogue, focusing on leading concepts, differentiating value, and feasibility considerations.'
        },
        'design-evaluation': {
          title: 'Design/Plan Evaluation',
          systemPrompt:
            'You are a PPSS evaluation advisor who narrates pilot results, quantifies trade-offs, and recommends refinements.',
          summaryPrompt:
            'Summarize the evaluation dialogue, emphasizing tested scenarios, key metrics, and recommended refinements for scale-up.'
        }
      };

      function parseStoredJSON(key, fallback) {
        try {
          const raw = localStorage.getItem(key);
          return raw ? JSON.parse(raw) : fallback;
        } catch (error) {
          console.warn('Unable to parse storage for', key, error);
          return fallback;
        }
      }

      const stageStatus = parseStoredJSON(STATUS_KEY, {});
      const rankingStore = parseStoredJSON(RANKING_KEY, {});

      function persistStatus(stage, completed) {
        stageStatus[stage] = completed;
        localStorage.setItem(STATUS_KEY, JSON.stringify(stageStatus));
        updateStageCompletionStyles();
      }

      function updateStageCompletionStyles() {
        stageButtons.forEach((button) => {
          const { stage } = button.dataset;
          const isComplete = Boolean(stageStatus[stage]);
          button.classList.toggle('completed', isComplete);
        });
      }

      function showStage(index) {
        stageButtons.forEach((btn, idx) => {
          const isActive = idx === index;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });

        stageContents.forEach((panel, idx) => {
          const shouldShow = idx === index;
          panel.classList.toggle('active', shouldShow);
          panel.toggleAttribute('hidden', !shouldShow);
        });

        if (progressFill) {
          const percent = stageCount > 1 ? (index / (stageCount - 1)) * 100 : 100;
          progressFill.style.width = `${Math.max(0, Math.min(100, percent))}%`;
        }

        if (progressLabel) {
          progressLabel.textContent = `Stage ${index + 1} of ${stageCount}`;
        }
      }

      stageButtons.forEach((button, index) => {
        button.addEventListener('click', () => showStage(index));
      });

      const evaluationPhotos = Array.from(document.querySelectorAll('.evaluation-photo'));
      const lightbox = document.querySelector('.evaluation-lightbox');
      const lightboxImg = lightbox?.querySelector('.lightbox-image');
      const lightboxCaption = lightbox?.querySelector('.lightbox-caption');

      function openLightbox(img, caption) {
        if (!lightbox || !lightboxImg || !lightboxCaption) return;
        lightboxImg.src = img.currentSrc || img.src;
        lightboxImg.alt = img.alt || '';
        lightboxCaption.textContent = caption || '';
        lightbox.classList.add('open');
        lightbox.removeAttribute('hidden');
        lightbox.setAttribute('aria-hidden', 'false');
        document.body.classList.add('lightbox-open');
      }

      function closeLightbox() {
        if (!lightbox || !lightboxImg || !lightboxCaption) return;
        lightbox.classList.remove('open');
        lightbox.setAttribute('aria-hidden', 'true');
        lightbox.setAttribute('hidden', '');
        lightboxImg.src = '';
        lightboxImg.alt = '';
        lightboxCaption.textContent = '';
        document.body.classList.remove('lightbox-open');
      }

      evaluationPhotos.forEach((figure) => {
        const img = figure.querySelector('img');
        const caption = figure.querySelector('figcaption')?.textContent || '';
        const zoomButton = figure.querySelector('.photo-zoom');

        function handleOpen() {
          if (img) {
            openLightbox(img, caption);
          }
        }

        if (img) {
          img.addEventListener('click', handleOpen);
        }

        if (zoomButton) {
          zoomButton.addEventListener('click', handleOpen);
        }
      });

      if (lightbox) {
        lightbox.addEventListener('click', (event) => {
          if (event.target instanceof HTMLElement && event.target.dataset.close === 'true') {
            closeLightbox();
          }
        });

        document.addEventListener('keydown', (event) => {
          if (event.key === 'Escape' && lightbox.classList.contains('open')) {
            closeLightbox();
          }
        });
      }

      function updateRankingBadge(figure, value) {
        const badge = figure.querySelector('.ranking-badge');
        if (!badge) return;
        if (!value) {
          badge.textContent = '';
          badge.hidden = true;
          figure.classList.remove('is-ranked');
          return;
        }
        const label = `Rank ${value}`;
        badge.textContent = label;
        badge.hidden = false;
        figure.classList.add('is-ranked');
      }

      function persistRankings() {
        localStorage.setItem(RANKING_KEY, JSON.stringify(rankingStore));
      }

      const rankingSelects = Array.from(document.querySelectorAll('.ranking-select'));
      const decisionRows = Array.from(document.querySelectorAll('.decision-table tbody tr[data-image-id]'));
      const chartRows = Array.from(document.querySelectorAll('.preference-chart__row[data-image-id]'));
      const leaderCard = document.querySelector('.leader-card');
      const leaderPlaceholder = document.querySelector('.leader-placeholder');
      const leaderImage = leaderCard?.querySelector('img');
      const leaderTitle = leaderCard?.querySelector('.leader-title');
      const leaderContributor = leaderCard?.querySelector('.leader-contributor');
      const leaderRank = leaderCard?.querySelector('.leader-rank');
      const leaderAffinity = leaderCard?.querySelector('.leader-affinity');
      const leaderCaption = leaderCard?.querySelector('.leader-caption');

      const conceptMetadata = {};

      evaluationPhotos.forEach((figure) => {
        const imageId = figure.dataset.imageId;
        if (!imageId) return;
        const img = figure.querySelector('img');
        const caption = figure.querySelector('figcaption')?.textContent?.trim() || '';
        conceptMetadata[imageId] = {
          ...(conceptMetadata[imageId] || {}),
          image: img ? img.currentSrc || img.src || '' : conceptMetadata[imageId]?.image || '',
          alt: img?.alt || conceptMetadata[imageId]?.alt || '',
          caption: caption || conceptMetadata[imageId]?.caption || ''
        };
      });

      decisionRows.forEach((row) => {
        const { imageId } = row.dataset;
        if (!imageId) return;
        const titleCell = row.querySelector('th');
        const cells = Array.from(row.querySelectorAll('td'));
        const contributorCell = cells[0];
        conceptMetadata[imageId] = {
          ...(conceptMetadata[imageId] || {}),
          title: titleCell?.textContent?.trim() || conceptMetadata[imageId]?.title || '',
          contributor: contributorCell?.textContent?.trim() || conceptMetadata[imageId]?.contributor || ''
        };
      });

      function computePreference(rankValue) {
        const rankNumber = Number(rankValue);
        if (!rankValue || Number.isNaN(rankNumber)) {
          return {
            label: 'Awaiting evaluation',
            width: '0%',
            rankText: 'Unranked',
            score: 0,
            rank: null,
            percent: 0
          };
        }

        const bounded = Math.max(1, Math.min(7, rankNumber));
        const preferencePercent = Math.round(((8 - bounded) / 7) * 100);
        const qualitative =
          bounded === 1
            ? 'Priority candidate'
            : bounded <= 3
            ? 'Preferred direction'
            : bounded <= 5
            ? 'Viable alternative'
            : 'Limited alignment';

        return {
          label: `${qualitative} ¬∑ ${preferencePercent}% affinity`,
          width: `${preferencePercent}%`,
          rankText: `Rank ${bounded}`,
          score: 8 - bounded,
          rank: bounded,
          percent: preferencePercent
        };
      }

      function updateDecisionTable() {
        decisionRows.forEach((row) => {
          const { imageId } = row.dataset;
          const rankCell = row.querySelector('.decision-rank');
          const preferenceCell = row.querySelector('.decision-preference');
          if (!imageId || !rankCell || !preferenceCell) return;

          const storedRank = rankingStore[imageId];
          const preferenceInfo = computePreference(storedRank);
          rankCell.textContent = preferenceInfo.rankText;

          const meter = preferenceCell.querySelector('.preference-meter span');
          const label = preferenceCell.querySelector('.preference-label');

          if (meter) {
            meter.style.width = preferenceInfo.width;
          }

          if (label) {
            label.textContent = preferenceInfo.label;
          }
        });
      }

      function updateDecisionInsights() {
        let topConcept = null;

        chartRows.forEach((row) => {
          const { imageId } = row.dataset;
          if (!imageId) return;
          const storedRank = rankingStore[imageId];
          const preferenceInfo = computePreference(storedRank);
          const meter = row.querySelector('.preference-chart__meter span');
          const value = row.querySelector('.preference-chart__value');

          if (meter) {
            meter.style.width = preferenceInfo.width;
          }

          if (value) {
            value.textContent =
              preferenceInfo.rankText === 'Unranked'
                ? 'Unranked'
                : `${preferenceInfo.rankText} ‚Äî ${preferenceInfo.label}`;
          }

          row.classList.toggle('is-ranked', Boolean(storedRank));

          if (storedRank) {
            const meta = conceptMetadata[imageId] || {};
            const score = preferenceInfo.score;
            if (
              !topConcept ||
              score > topConcept.score ||
              (score === topConcept.score && (preferenceInfo.rank || 99) < (topConcept.rank || 99))
            ) {
              topConcept = {
                imageId,
                score,
                rank: preferenceInfo.rank,
                info: preferenceInfo,
                meta
              };
            }
          }
        });

        if (topConcept && topConcept.rank) {
          if (leaderPlaceholder) {
            leaderPlaceholder.setAttribute('hidden', '');
          }
          if (leaderCard) {
            leaderCard.removeAttribute('hidden');
          }
          if (leaderImage) {
            leaderImage.src = topConcept.meta.image || '';
            leaderImage.alt = topConcept.meta.alt || topConcept.meta.title || 'Top-ranked concept';
          }
          if (leaderTitle) {
            leaderTitle.textContent = topConcept.meta.title || 'Top concept';
          }
          if (leaderContributor) {
            const contributorText = topConcept.meta.contributor ? `Contributor: ${topConcept.meta.contributor}` : '';
            if (contributorText) {
              leaderContributor.textContent = contributorText;
              leaderContributor.removeAttribute('hidden');
            } else {
              leaderContributor.textContent = '';
              leaderContributor.setAttribute('hidden', '');
            }
          }
          if (leaderRank) {
            leaderRank.textContent = `Rank ${topConcept.rank}`;
          }
          if (leaderAffinity) {
            leaderAffinity.textContent = topConcept.info.label;
          }
          if (leaderCaption) {
            leaderCaption.textContent = topConcept.meta.caption || '';
          }
        } else {
          if (leaderCard) {
            leaderCard.setAttribute('hidden', '');
            if (leaderImage) {
              leaderImage.src = '';
              leaderImage.alt = '';
            }
            if (leaderTitle) {
              leaderTitle.textContent = '';
            }
            if (leaderContributor) {
              leaderContributor.textContent = '';
              leaderContributor.setAttribute('hidden', '');
            }
            if (leaderRank) {
              leaderRank.textContent = '';
            }
            if (leaderAffinity) {
              leaderAffinity.textContent = '';
            }
            if (leaderCaption) {
              leaderCaption.textContent = '';
            }
          }
          if (leaderPlaceholder) {
            leaderPlaceholder.removeAttribute('hidden');
          }
        }
      }

      rankingSelects.forEach((select) => {
        const { imageId } = select.dataset;
        if (!imageId) return;
        const figure = document.querySelector(`.evaluation-photo[data-image-id="${imageId}"]`);
        const storedValue = rankingStore[imageId];
        if (storedValue) {
          select.value = storedValue;
          if (figure) {
            updateRankingBadge(figure, storedValue);
          }
        }

        select.addEventListener('change', () => {
          const value = select.value;
          if (value) {
            rankingStore[imageId] = value;
          } else {
            delete rankingStore[imageId];
          }
          if (figure) {
            updateRankingBadge(figure, value);
          }
          persistRankings();
          updateDecisionTable();
          updateDecisionInsights();
        });
      });

      updateDecisionTable();
      updateDecisionInsights();

      function showTab(id) {
        tabButtons.forEach((btn) => {
          const isActive = btn.dataset.tab === id;
          btn.classList.toggle('active', isActive);
          btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
        });

        tabPanels.forEach((panel) => {
          const shouldShow = panel.id === id;
          panel.classList.toggle('active', shouldShow);
          panel.toggleAttribute('hidden', !shouldShow);
        });
      }

      tabButtons.forEach((button) => {
        button.addEventListener('click', () => showTab(button.dataset.tab));
      });

      function loadConversation(stage) {
        return parseStoredJSON(CONVERSATION_KEY(stage), []);
      }

      function saveConversation(stage, conversation) {
        localStorage.setItem(CONVERSATION_KEY(stage), JSON.stringify(conversation));
      }

      function appendMessage(chatLog, role, content, options = {}) {
        const message = document.createElement('div');
        message.className = `message ${role}${options.pending ? ' pending' : ''}`;
        const roleLabel =
          role === 'assistant' ? 'ChatGPT' : role === 'system' ? 'System' : 'Resident';
        const roleSpan = document.createElement('span');
        roleSpan.className = 'role';
        roleSpan.textContent = roleLabel;
        const body = document.createElement('p');
        body.textContent = content;
        message.append(roleSpan, body);
        chatLog.appendChild(message);
        chatLog.scrollTop = chatLog.scrollHeight;
        return message;
      }

      function renderStoredConversation(stage) {
        const chatLog = document.querySelector(`.chat-log[data-stage="${stage}"]`);
        if (!chatLog) return;
        const stored = loadConversation(stage);
        stored.forEach((entry) => {
          appendMessage(chatLog, entry.role, entry.content);
        });
      }

      Object.keys(stageConfig).forEach(renderStoredConversation);

      function setStageStatus(stage, message, statusClass = '') {
        const container = document.querySelector(`.stage-content#${stage} .stage-status`);
        if (!container) return;
        container.textContent = message;
        container.className = `stage-status ${statusClass}`.trim();
      }

      async function callChatGPT(messages, options = {}) {
        const { apiKey, model = 'gpt-4o' } = options;
        if (!apiKey) {
          const error = new Error('missing_api_key');
          error.code = 'missing_api_key';
          throw error;
        }

        try {
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model,
              messages,
              temperature: 0.4
            })
          });

          if (!response.ok) {
            const error = new Error(`OpenAI error: ${response.status}`);
            error.code = 'api_error';
            throw error;
          }

          const data = await response.json();
          const choice = data.choices && data.choices[0];
          if (!choice) {
            const error = new Error('No completion choices returned');
            error.code = 'api_error';
            throw error;
          }
          return {
            role: choice.message.role || 'assistant',
            content: (choice.message.content || '').trim()
          };
        } catch (error) {
          console.error('ChatGPT call failed', error);
          if (!error.code) {
            error.code = 'network_error';
          }
          throw error;
        }
      }

      function fallbackSummary(stage, conversation) {
        const stageInfo = stageConfig[stage];
        if (!conversation.length) {
          return `No dialogue captured yet for the ${stageInfo.title} stage.`;
        }
        const userHighlights = conversation
          .filter((entry) => entry.role === 'user')
          .slice(-3)
          .map((entry, index) => `${index + 1}. ${entry.content}`);
        if (!userHighlights.length) {
          return `Dialogue was recorded, but only assistant responses are stored for the ${stageInfo.title} stage.`;
        }
        return [`Highlights from ${stageInfo.title}:`, ...userHighlights].join('\n');
      }

      async function summarizeStage(stage) {
        const conversation = loadConversation(stage);
        const stageInfo = stageConfig[stage];
        if (!stageInfo) return;

        if (!conversation.length) {
          setStageStatus(stage, 'Start a dialogue before requesting a summary.', 'warning');
          return;
        }

        const apiKey = localStorage.getItem(API_KEY_STORAGE);
        let summaryText;
        let usedFallback = false;

        if (apiKey) {
          const conversationTranscript = conversation
            .map((entry) => `${entry.role.toUpperCase()}: ${entry.content}`)
            .join('\n');
          const messages = [
            {
              role: 'system',
              content:
                'You are a report automation assistant who condenses PPSS design conversations into concise, insight-rich summaries.'
            },
            {
              role: 'user',
              content: `${stageInfo.summaryPrompt}\n\nDialogue:\n${conversationTranscript}`
            }
          ];
          try {
            const completion = await callChatGPT(messages, { apiKey });
            summaryText = completion.content || fallbackSummary(stage, conversation);
            if (!completion.content) {
              usedFallback = true;
            }
          } catch (error) {
            console.error('Summary generation failed', error);
            summaryText = fallbackSummary(stage, conversation);
            usedFallback = true;
          }
        } else {
          summaryText = fallbackSummary(stage, conversation);
          usedFallback = true;
        }

        localStorage.setItem(SUMMARY_KEY(stage), JSON.stringify({
          summary: summaryText,
          stage: stageInfo.title,
          timestamp: new Date().toISOString()
        }));
        persistStatus(stage, true);
        const statusMessage = usedFallback
          ? 'Local highlight summary saved to the report dashboard. Connect ChatGPT for richer synthesis.'
          : 'Stage summary saved to the report dashboard.';
        setStageStatus(stage, statusMessage, usedFallback ? 'warning' : 'success');
      }

      function handleChatSubmit(event) {
        event.preventDefault();
        const form = event.currentTarget;
        const input = form.querySelector('.chat-input');
        const message = input.value.trim();
        if (!message) return;
        input.value = '';

        const stage = form.dataset.stage;
        const stageInfo = stageConfig[stage];
        const chatLog = document.querySelector(`.chat-log[data-stage="${stage}"]`);
        const conversation = loadConversation(stage);

        appendMessage(chatLog, 'user', message);
        conversation.push({ role: 'user', content: message });
        saveConversation(stage, conversation);

        const pending = appendMessage(chatLog, 'assistant', 'Awaiting response from the ChatGPT API...', { pending: true });

        (async () => {
          const messages = [
            { role: 'system', content: stageInfo.systemPrompt },
            ...conversation
          ];
          try {
            const apiKey = localStorage.getItem(API_KEY_STORAGE);
            if (!apiKey) {
              const error = new Error('missing_api_key');
              error.code = 'missing_api_key';
              throw error;
            }
            const completion = await callChatGPT(messages, { apiKey });
            pending.remove();
            if (!completion.content) {
              return;
            }
            const assistantRole = completion.role || 'assistant';
            appendMessage(chatLog, assistantRole, completion.content);
            conversation.push({ role: assistantRole, content: completion.content });
            saveConversation(stage, conversation);
            const statusEl = document.querySelector(`.stage-content#${stage} .stage-status`);
            if (statusEl && (statusEl.classList.contains('warning') || statusEl.classList.contains('error'))) {
              setStageStatus(stage, '');
            }
          } catch (error) {
            pending.remove();
            const statusMessage =
              error.code === 'missing_api_key'
                ? 'Add your OpenAI API key in Settings to receive assistant replies.'
                : 'The platform could not reach the ChatGPT API. Check your credentials or try again shortly.';
            const statusClass = error.code === 'missing_api_key' ? 'warning' : 'error';
            setStageStatus(stage, statusMessage, statusClass);
          }
        })();
      }

      document.querySelectorAll('.chat-form').forEach((form) => {
        form.addEventListener('submit', handleChatSubmit);
      });

      completeButtons.forEach((button) => {
        button.addEventListener('click', () => summarizeStage(button.dataset.stage));
      });

      updateStageCompletionStyles();
      const defaultIndex = stageButtons.findIndex((button) => button.classList.contains('active'));
      showStage(defaultIndex >= 0 ? defaultIndex : 0);
      Object.keys(stageConfig).forEach((stage) => {
        const summaryInfo = parseStoredJSON(SUMMARY_KEY(stage), null);
        if (summaryInfo && summaryInfo.summary) {
          setStageStatus(stage, 'Summary ready for the report dashboard.', 'success');
        }
      });
    })();
  </script>
</body>
</html>
