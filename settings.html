<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Settings | ChatGPT-assisted PPSS Platform</title>
  <link rel="stylesheet" href="styles/main.css" />
</head>
<body>
  <nav class="sidebar">
    <div class="logo">PPSS</div>
    <ul>
      <li><a href="index.html"><span class="icon">üè†</span><span>Home</span></a></li>
      <li><a href="workspace.html"><span class="icon">üß†</span><span>Workspace</span></a></li>
      <li><a href="report.html"><span class="icon">üìä</span><span>Report</span></a></li>
      <li><a href="settings.html" class="active"><span class="icon">‚öôÔ∏è</span><span>Settings</span></a></li>
    </ul>
  </nav>
  <main class="content">
    <header>
      <h1>Platform Settings</h1>
    </header>
    <section>
      <p>
        Configure access levels, integrate organizational data sources, and tailor the conversational tone of ChatGPT to match the domain expertise required in proactive PPSS development.
      </p>
      <p>
        Personalization ensures that analytics dashboards, co-design templates, and notification routines align with the operational context presented in the study.
      </p>
      <p class="workspace-meta" id="settings-workspace-meta" hidden>
        Managing settings for workspace code: <span class="workspace-code-emphasis" id="settings-workspace-code"></span>
      </p>
    </section>
    <section class="settings-card">
      <h2>ChatGPT API Access</h2>
      <p>
        API connectivity is now handled on the backend for each workspace. Provide your credentials in the server configuration so the frontend can call the proxy without storing keys in the browser.
      </p>
      <p class="form-status info" aria-live="polite">
        Tip: update the backend request handler to inject the correct OpenAI or Azure OpenAI credentials for the active workspace.
      </p>
    </section>
  </main>
  <script>
    (function () {
      const STORAGE_PREFIX = 'ppss';
      const ACTIVE_WORKSPACE_KEY = `${STORAGE_PREFIX}-active-code`;

      const params = new URLSearchParams(window.location.search);
      let workspaceId = params.get('code');
      if (workspaceId) {
        workspaceId = workspaceId.trim();
        if (workspaceId) {
          localStorage.setItem(ACTIVE_WORKSPACE_KEY, workspaceId);
        }
      }

      if (!workspaceId) {
        const stored = localStorage.getItem(ACTIVE_WORKSPACE_KEY);
        workspaceId = stored ? stored.trim() : '';
      }

      if (!workspaceId) {
        window.location.replace('index.html?login=required');
        return;
      }

      if (params.has('code')) {
        params.delete('code');
        const newUrl = `${window.location.pathname}${params.toString() ? `?${params}` : ''}${window.location.hash}`;
        window.history.replaceState({}, '', newUrl);
      }

      const workspaceKeySegment = encodeURIComponent(workspaceId);
      const workspaceMeta = document.getElementById('settings-workspace-meta');
      const workspaceCodeDisplay = document.getElementById('settings-workspace-code');
      if (workspaceCodeDisplay) {
        workspaceCodeDisplay.textContent = workspaceId;
      }
      if (workspaceMeta) {
        workspaceMeta.hidden = false;
      }
    })();
  </script>
</body>
</html>
